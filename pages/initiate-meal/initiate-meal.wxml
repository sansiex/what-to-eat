<!-- pages/initiate-meal/initiate-meal.wxml -->
<view class="container">
  <view class="section">
    <text class="dialog-title">{{isEditMode ? '编辑点餐' : '开始点菜'}}</text>
    
    <!-- 餐名选择 -->
    <view style="margin-bottom: 24rpx;">
      <text style="display: block; margin-bottom: 12rpx; font-size: 28rpx;">餐名</text>
      <view style="display: flex; gap: 12rpx; margin-bottom: 16rpx;">
        <button 
          wx:for="{{mealTypes}}" 
          wx:key="{{item}}"
          style="font-size: 28rpx; padding: 12rpx 24rpx; flex: 1; text-align: center;"
          bindtap="selectMealType" 
          data-type="{{item}}"
        >
          {{item}}
        </button>
        <button 
          style="font-size: 28rpx; padding: 12rpx 24rpx; flex: 1; text-align: center;"
          bindtap="showCustomMealDialog"
        >
          自定义
        </button>
      </view>
      <input 
        wx:if="{{showCustomInput}}" 
        class="input" 
        placeholder="请输入自定义餐名" 
        bindinput="onCustomMealInput"
        value="{{customMealName}}"
      />
      <text wx:if="{{selectedMealName}}" style="margin-top: 12rpx; font-size: 28rpx; color: #007AFF;">
        已选择：{{selectedMealName}}
      </text>
    </view>
    
    <!-- 菜品选择 -->
    <view>
      <view style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12rpx;">
        <text style="font-size: 28rpx;">菜品选择（默认全选）</text>
        <button 
          style="font-size: 24rpx; padding: 6rpx 12rpx;" 
          bindtap="toggleSelectAll"
        >
          {{selectAll ? '取消全选' : '全选'}}
        </button>
      </view>
      
      <view wx:if="{{dishes.length === 0}}" style="padding: 40rpx 0; text-align: center; color: #999;">
        暂无菜品，请先在首页添加
      </view>
      
      <view wx:else>
        <view 
          wx:for="{{dishes}}" 
          wx:key="{{item.id}}" 
          class="list-item"
        >
          <view style="display: flex; align-items: center;">
            <checkbox 
              class="checkbox" 
              value="{{item.id}}"
              checked="{{item.selected}}" 
              bindtap="toggleDishSelection"
              data-id="{{item.id}}"
            />
            <text class="list-item__title">{{item.name}}</text>
          </view>
        </view>
      </view>
    </view>
    
    <!-- 按钮区域 -->
    <view wx:if="{{isEditMode}}" style="display: flex; gap: 20rpx; margin-top: 40rpx;">
      <button 
        class="btn" 
        style="flex: 1; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);"
        bindtap="completeEdit"
        disabled="{{!selectedMealName}}">
        完成
      </button>
      <button 
        class="btn" 
        style="flex: 1; background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);"
        bindtap="goBack">
        返回
      </button>
    </view>
    <button 
      wx:else
      class="btn" 
      bindtap="initiateMeal"
      disabled="{{!selectedMealName}}">
      开始点菜
    </button>
  </view>
  
  <!-- 自定义餐名对话框 -->
  <view wx:if="{{showCustomDialog}}" class="dialog">
    <view class="dialog-content">
      <text class="dialog-title">自定义餐名</text>
      <input 
        class="input" 
        placeholder="请输入餐名" 
        bindinput="onCustomMealInput"
        value="{{customMealName}}"
      />
      <view class="dialog-actions">
        <view class="dialog-btn dialog-btn--cancel" bindtap="hideCustomDialog">取消</view>
        <view class="dialog-btn dialog-btn--confirm" bindtap="confirmCustomMeal">确定</view>
      </view>
    </view>
  </view>
</view>